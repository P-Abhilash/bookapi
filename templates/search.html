{% extends "base.html" %}
{% block title %}Search Results{% endblock %}
{% block content %}
<h2>Search Google Books</h2>
<form method="get" action="/search">
    <input type="text" name="q" value="{{ query or '' }}" placeholder="Search for books"
        style="width: 50%; padding: 1em; font-size: 1.2em;">
    <button type="submit" style="padding: 0.8em 2em;">Search</button>
</form>

{% if books %}
<hr>
<div style="display: flex; flex-direction: column; gap: 20px; margin-top: 20px;">
    {% for book in books %}
    {% set info = book.volumeInfo %}
    <div
        style="display: flex; gap: 15px; border: 1px solid #ccc; border-radius: 8px; padding: 15px; background-color: #fdfdfd;">
        <div>
            {% if info.imageLinks and info.imageLinks.thumbnail %}
            <img src="{{ info.imageLinks.thumbnail }}" alt="Book Cover" style="height: 150px;">
            {% else %}
            <div
                style="width: 100px; height: 150px; background: #eee; display: flex; align-items: center; justify-content: center;">
                No Image</div>
            {% endif %}
        </div>
        <div>
            <h3 style="margin: 0;">{{ info.title }}</h3>
            <p style="margin: 5px 0;">
                {% if info.authors %}<strong>{{ info.authors | join(', ') }}</strong>{% endif %}
                {% if info.publishedDate %}
                {% set parts = info.publishedDate.split('-') %}
                ‚Ä¢
                {% if parts|length == 3 %}
                {{ parts[2] }} {{
                ["January","February","March","April","May","June","July","August","September","October","November","December"][parts[1]|int
                - 1] }} {{ parts[0] }}
                {% elif parts|length == 2 %}
                {{
                ["January","February","March","April","May","June","July","August","September","October","November","December"][parts[1]|int
                - 1] }} {{ parts[0] }}
                {% else %}
                {{ parts[0] }}
                {% endif %}
                {% endif %}

            </p>
            {% if info.averageRating %}
            <p>‚≠ê {{ info.averageRating }} ({{ info.ratingsCount or 0 }} ratings)</p>
            {% endif %}
            {% if info.description %}
            <p>{{ info.description[:250] }}{% if info.description|length > 250 %}...{% endif %}</p>
            {% endif %}
            {% if info.previewLink %}
            <a href="{{ info.previewLink }}" target="_blank">üìñ Preview</a>
            {% endif %}
        </div>
    </div>
    {% endfor %}
</div>
{% elif query %}
<p>No results found for "{{ query }}"</p>
{% endif %}
{% endblock %}