{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<style>
  body {
    background: #7F694C ;
  }

  .dashboard-header {
    font-weight: 700;
    color: #343a40;
  }

  .card-modern {
    background: #d2b48c;
    border-radius: 18px;
    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.06);
    transition: all 0.2s ease-in-out;
  }

  .card-modern:hover {
    transform: translateY(-3px);
    box-shadow: 0 12px 30px rgba(0, 0, 0, 0.08);
  }

  .card-body {
    padding: 1.2rem;
  }

  .card-title {
    font-weight: 600;
    font-size: 1.1rem;
    margin-bottom: 0.8rem;
    color: #4c2c02;
  }

  .scrollable-card {
    max-height: 260px;
    overflow-y: auto;
    scrollbar-width: thin;
  }

  .list-group-item {
    border: none;
    border-bottom: 1px solid #eee;
    padding: 0.6rem 0.4rem;
  }

  .list-group-item:last-child {
    border-bottom: none;
  }

  .btn-clear {
    font-size: 0.75rem;
    padding: 2px 10px;
    float: right;
  }

  .thumb-img {
    width: 38px;
    height: auto;
    object-fit: contain;
    margin-right: 10px;
  }

  .card-header-flex {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 0.6rem;
  }

  .text-muted-small {
    font-size: 0.8rem;
    color: #999;
    margin-bottom: 0.5rem;
  }

  a {
    color: #1a73e8;
    /* Soft Google-style blue */
    text-decoration: none;
    /* No underline */
    transition: color 0.2s ease;
  }

  a:hover {
    color: #0c47a1;
    /* Darker on hover */
    text-decoration: none;
    /* Still no underline */
  }


  /* üåê Smooth, modern scrollbar styling */
  .scrollable-card::-webkit-scrollbar {
    width: 8px;
  }

  .scrollable-card::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
  }

  .scrollable-card::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 10px;
  }

  .scrollable-card::-webkit-scrollbar-thumb:hover {
    background: #a8a8a8;
  }
</style>

<div class="container py-4">
  <h2 class="mb-4 dashboard-header">üìö Welcome, {{ user }}!</h2>
  <div class="row row-cols-1 row-cols-md-2 g-4">

    <div class="col">
      <div class="card card-modern">
        <div class="card-body scrollable-card">
          <div class="card-header-flex">
            <h5 class="card-title">Favorites</h5>
            <a href="/favorites" class="btn btn-sm btn-outline-primary">View All</a>
          </div>
          {% if favorites %}
          <ul class="list-group list-group-flush">
            {% for fav in favorites %}
            <li class="list-group-item d-flex align-items-center">
              {% if fav.thumbnail %}
              <img src="{{ fav.thumbnail }}" class="thumb-img" alt="thumb">
              {% endif %}
              <a href="/book/{{ fav.book_id }}" class="text-link">{{ fav.title }}</a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-muted">You haven‚Äôt favorited any books yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- üìÅ My Shelves -->
    <div class="col">
      <div class="card card-modern">
        <div class="card-body scrollable-card">
          <div class="card-header-flex">
            <h5 class="card-title">üìÅ My Shelves</h5>
            <a href="/shelves" class="btn btn-sm btn-outline-primary">Manage</a>
          </div>
          {% if shelves %}
          <ul class="list-group list-group-flush">
            {% for shelf in shelves %}
            <li class="list-group-item">
              <a href="/shelf/{{ shelf.id }}" class="text-link">{{ shelf.name }}</a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-muted">You haven‚Äôt created any shelves yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- üîç Search History -->
    <div class="col">
      <div class="card card-modern shadow-sm h-100">
        <div class="card-body scrollable-card">
          <div class="d-flex justify-content-between align-items-center mb-2">
            <h5 class="card-title mb-0">üîç Search History</h5>
            <a href="/clear-search-history" class="btn btn-sm btn-outline-danger">Clear</a>
          </div>
          <hr class="my-2">
          {% if search_history_zipped %}
          <ul class="list-group list-group-flush">
            {% for raw, label in search_history_zipped %}
            <li class="list-group-item px-2 py-2">
              <a href="/search?q={{ raw | urlencode }}" class="text-decoration-none history-link d-block">
                üîé {{ label }}
              </a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-muted">No recent searches yet.</p>
          {% endif %}
        </div>
      </div>
    </div>

    <!-- üìñ Recently Viewed -->
    <div class="col">
      <div class="card card-modern">
        <div class="card-body scrollable-card">
          <div class="card-header-flex">
            <h5 class="card-title">üìñ Recently Viewed</h5>
            <a href="/clear-recently-viewed" class="btn btn-sm btn-outline-danger">Clear</a>
          </div>
          {% if viewed_books %}
          <ul class="list-group list-group-flush">
            {% for book in viewed_books %}
            <li class="list-group-item d-flex align-items-center">
              {% if book.thumbnail %}
              <img src="{{ book.thumbnail }}" alt="thumb" class="thumb-img">
              {% else %}
              <div class="me-2 bg-secondary text-white d-flex align-items-center justify-content-center"
                style="width:40px; height:60px; font-size:12px;">No Image</div>
              {% endif %}
              <a href="/book/{{ book.id }}" class="text-link">{{ book.title }}</a>
            </li>
            {% endfor %}
          </ul>
          {% else %}
          <p class="text-muted">No recently viewed books.</p>
          {% endif %}
        </div>
      </div>
    </div>
    <!-- üß© Browse by Genre -->
<div class="col-12">
  <div class="card card-modern">
    <div class="card-body">
      <div class="card-header-flex">
        <h5 class="card-title">üß© Browse by Genre</h5>
      </div>
      {% if genres %}
      <div class="row row-cols-2 row-cols-md-4 g-3 mt-2">
        {% for genre in genres %}
        <div class="col">
          <a href="/search?filter=subject&q='{{ genre.link | urlencode }}'" class="text-decoration-none">
            <div class="card h-100 text-center p-3 shadow-sm border-0 genre-card hover-shadow" style="border-radius: 12px;">
              <div class="mb-2">
                {% if genre.icon %}
                <img src="{{ genre.icon }}" alt="{{ genre.name }}" class="img-fluid" style="max-height: 40px;">
                {% endif %}
              </div>
              <div class="fw-semibold">{{ genre.name }}</div>
            </div>
          </a>
        </div>
        {% endfor %}
      </div>
      {% else %}
      <p class="text-muted">No genres available right now.</p>
      {% endif %}
    </div>
  </div>
</div>
  </div>
</div>
{% endblock %}

